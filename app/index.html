<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Code in the Dark</title>
    <script src="bundle.js" inline></script>
  </head>
  <body>
    <div class="background"></div>
    <canvas class="canvas-overlay"></canvas>
    <pre id="editor"></pre>
    <div class="streak-container">
        <div class="current">Combo</div>
        <div class="counter">0</div>
        <div class="bar"></div>
        <div class="exclamations"></div>
    </div>

    <div class="timer">
      <button class="timer__button" type="button">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 340.274 340.274">
          <path d="M293.629 127.806l-5.795-13.739c19.846-44.856 18.53-46.189 14.676-50.08l-25.353-24.77-2.516-2.12h-2.937c-1.549 0-6.173 0-44.712 17.48l-14.184-5.719c-18.332-45.444-20.212-45.444-25.58-45.444h-35.765c-5.362 0-7.446-.006-24.448 45.606l-14.123 5.734C86.848 43.757 71.574 38.19 67.452 38.19l-3.381.105-27.27 26.737c-4.138 3.891-5.582 5.263 15.402 49.425l-5.774 13.691C0 146.097 0 147.838 0 153.33v35.068c0 5.501 0 7.44 46.585 24.127l5.773 13.667c-19.843 44.832-18.51 46.178-14.655 50.032l25.353 24.8 2.522 2.168h2.951c1.525 0 6.092 0 44.685-17.516l14.159 5.758c18.335 45.438 20.218 45.427 25.598 45.427h35.771c5.47 0 7.41 0 24.463-45.589l14.195-5.74c26.014 11 41.253 16.585 45.349 16.585l3.404-.096 27.479-26.901c3.909-3.945 5.278-5.309-15.589-49.288l5.734-13.702c46.496-17.967 46.496-19.853 46.496-25.221V151.88c-.005-5.519-.005-7.446-46.644-24.074zM170.128 228.474c-32.798 0-59.504-26.187-59.504-58.364 0-32.153 26.707-58.315 59.504-58.315 32.78 0 59.43 26.168 59.43 58.315-.006 32.177-26.656 58.364-59.43 58.364z"/>
        </svg>
        <span>Open settings</span>
      </button>
      <h2 class="timer__title">Timer</h2>
      <p class="timer__display timer__display--disabled">00:00</p>
    </div>

    <div class="reference-screenshot-container">
      <span>Reference</span>
      <div class="reference-screenshot" style="background-image:url(assets/page.png);"></div>
    </div>

    <div class="name-tag">
      Unnamed
    </div>

    <div class="power-mode-indicator">
      <h1>POWER MODE!</h1>
    </div>

    <div class="instructions-container">
      <iframe class="instructions" src="assets/instructions.html"></iframe>
    </div>

    <div class="button-bar">
      <button class="download-button">Download File</button>
      <button class="finish-button">Finish</button>
      <button class="instructions-button">Instructions</button>
    </div>

    <iframe class="result" src="assets/result.html" frameborder="0"></iframe>

      <div class="modal">
        <h2 class="modal__title">Timer Setting</h2>
        <form class="form modal__form">
          <input class="form__input form__input--checkbox" id="need-timer" type="checkbox">
          <label class="form__label form__label--checkbox" for="need-timer">Off/On</label>
          <label >
          <input class="form__input form__input--number" type="number" min="1" max="59">
          Minutes</label>
          <div class="modal__footer">
            <button id="save-setting-timer" type="submit">Save</button>
            <button class="modal__close-btn" type="button">Close</button>
          </div>
        </form>
      </div>
      <div class="timer-overlay">
        <strong class="timer-overlay__message">TIME OVER</strong>
      </div>

      <script>
          var needUseTimer = false;
          var minutes = 0;
          var isTimerStart = false;

          var setting = document.querySelector('.timer__button');
          var settingModal = document.querySelector('.modal');
          var form = document.querySelector('.modal__form');
          var closeSetting = document.querySelector('.modal__close-btn');

          var timerDisplay = document.querySelector('.timer__display');

          var referenceScreenshot = document.querySelector('.reference-screenshot');
          var overlay = document.querySelector('.timer-overlay');

          setting.addEventListener('click', function () {
              if (settingModal.classList.contains('modal--show')) {
                  settingModal.classList.remove('modal--show');
              } else {
                  settingModal.classList.add('modal--show');
              }
          });

          closeSetting.addEventListener('click', function () {
              settingModal.classList.remove('modal--show');
          });

          form.addEventListener('submit', function (event) {
              event.preventDefault();
              needUseTimer = event.target[0].checked;
              minutes = event.target[1].value;
              if (needUseTimer) {
                  var a = new Date();
                  a.setMinutes(minutes);
                  timerDisplay.textContent = a.getMinutes() + ":00";
                  timerDisplay.classList.remove('timer__display--disabled');
              }
              else {
                  timerDisplay.textContent = "00:00";
                  timerDisplay.classList.add('timer__display--disabled');
              }
              settingModal.classList.remove('modal--show');
          });

          referenceScreenshot.addEventListener('click', function () {
              if (needUseTimer) {
                  var allTimer = new Date(Date.now() + minutes * 60000);
                  setting.disabled = true;
                  // noinspection JSAnnotator
                  function timer() {
                      var currentTime = Date.now();
                      var diff = allTimer.getTime() - currentTime;
                      if (diff >= 0) {
                          var t = new Date(0);
                          t.setSeconds(0, diff);
                          timerDisplay.textContent = t.getMinutes() + ":" + t.getSeconds();
                          requestAnimationFrame(timer);
                      }
                      else {
                          overlay.classList.add('timer-overlay--show');
                          window.addEventListener('keydown', function (event) {
                              event.preventDefault();
                              event.stopImmediatePropagation();
                          });
                      }
                  };

                  if (isTimerStart === false) {
                      isTimerStart = true;
                      timer();
                  }
              }
          });
      </script>
  </body>
</html>
